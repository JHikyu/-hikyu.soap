const http=require("http"),fs=require("fs"),url=require("url"),ev=require("events"),eventEmitter=new ev.EventEmitter,ejs=require("ejs"),pug=require("pug"),{on,once}=require("./src/events")(eventEmitter),routes=require("./src/routes"),responseFunctions=require("./src/responseFunctions"),requestParameters=require("./src/requestParameters"),public=require("./src/public");function init(e){try{http.createServer(async function(r,n){var e=url.parse(r.url,!0)["pathname"];eventEmitter.emit("request",{path:e}),r.query=requestParameters.query(r),r.post=await requestParameters.post(r),n.send=e=>responseFunctions.send(r,n,eventEmitter,e),n.json=e=>responseFunctions.json(r,n,eventEmitter,e),n.render=(e,t)=>responseFunctions.render(r,n,eventEmitter,e,t),routes.check(e,r,n,eventEmitter)||await public(e,r,n,eventEmitter)||(responseFunctions.writeEnd(n,404,"text/plain",null,`Cannot ${r.method} `+e),eventEmitter.emit("404",{path:e}))}).listen(e),eventEmitter.emit("started",{port:e})}catch(e){reject(e)}}module.exports={init:init,on:on,once:once,get:routes.get,post:routes.post};